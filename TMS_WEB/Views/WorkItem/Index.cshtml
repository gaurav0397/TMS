@model IEnumerable<TMS_WEB.Models.WorkItem>



<h1 class="my-4">Tasks</h1>

<a asp-controller="WorkItem" asp-action="Create" class="btn btn-primary my-4">Create New Task</a>
<button id="exportBtn" class="btn btn-primary" onclick="exportTableToExcel">Export to Excel</button>

<table class="table table-striped table-bordered" id="table">
    <thead class="thead-dark">

        <tr>
            <th>ID</th>
            <th>Description</th>
            <th>AssignedTo</th>
            <th>CreationDate</th>
            <th>Duedate</th>
            <th>Status</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            <tr class="clickable-row" data-id="@item.Id">
                <td>@item.Id</td>
                <td>@item.Description</td>
                <td>@item.employee.EmployeeName</td>
                <td>@item.CreationDate</td>
                <td>@item.Duedate</td>
                @if (item.Status==1)
                {
                    <td>New</td>
                }
                else if(item.Status==2)
                {
                    <td>In progress</td>
                }
                else
                {
                    <td>Completed</td>
                }
            </tr>
        }
    </tbody>
</table>
<small>Click on the row to edit.</small>

@* <script src="../wwwroot/js/xlsx.full.min.js"></script> *@
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.0/dist/xlsx.full.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        var rows = document.querySelectorAll('.clickable-row');
        rows.forEach(function (row) {
            row.addEventListener('click', function () {
                var itemId = this.getAttribute('data-id');
                window.location.href = '@Url.Action("Update", "WorkItem")/' + itemId;
            });
        });

        var exportBtn = document.getElementById('exportBtn');
        exportBtn.addEventListener('click', function () {
            exportTableToExcel();
        });
    });

    function exportTableToExcel(filename = 'exported_table') {
        var table = document.getElementById('table');
        var wb = XLSX.utils.table_to_book(table);
        var wbout = XLSX.write(wb, { bookType: 'xlsx', bookSST: true, type: 'binary' });
        var blob = new Blob([s2ab(wbout)], { type: 'application/octet-stream' });
        var url = URL.createObjectURL(blob);
        var a = document.createElement('a');
        a.href = url;
        a.download = filename + '.xlsx';
        document.body.appendChild(a);
        a.click();
        setTimeout(function () {
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }, 0);
    }

    function s2ab(s) {
        var buf = new ArrayBuffer(s.length);
        var view = new Uint8Array(buf);
        for (var i = 0; i < s.length; i++) view[i] = s.charCodeAt(i) & 0xff;
        return buf;
    }


</script>

